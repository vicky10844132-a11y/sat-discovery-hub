<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPTM SOVEREIGN // CUSTOM SKIN</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* --- THEME: ELITE BLACK GOLD & AMBER --- */
        :root {
            --bg-root: #000000;
            --bg-panel: #050505;
            --border: #333;
            
            --accent-xiaoer: #10b981; /* Green */
            --accent-dushe: #f59e0b;  /* Amber */
            --accent-admin: #ffd700;  /* Gold */
            --accent-data: #3b82f6;   /* Blue */
            
            --font-mono: "JetBrains Mono", monospace;
            --font-ui: "Inter", sans-serif;
        }

        body.god-mode { --border: #5c4d26; }
        body.god-mode .sidebar { border-color: var(--accent-admin); }

        * { box-sizing: border-box; outline: none; }
        /* Default cursor on login, crosshair inside */
        body { margin: 0; padding: 0; font-family: var(--font-ui); background: var(--bg-root); color: #888; overflow: hidden; height: 100vh; width: 100vw; cursor: default; }
        #app.unlocked { cursor: crosshair; }

        #app { display: flex; flex-direction: column; height: 100%; filter: blur(10px); transition: 0.8s; pointer-events: none; }
        #app.unlocked { filter: blur(0); pointer-events: all; }

        /* --- LOGIN --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; background: #000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .login-box { width: 500px; /* Widened slightly */ padding: 40px; border: 1px solid #333; background: #050505; box-shadow: 0 0 100px rgba(255,255,255,0.02); border-radius: 12px; }
        .login-title { font-size: 20px; font-weight: 900; color: #fff; margin-bottom: 20px; letter-spacing: 4px; text-align: center; }
        .login-input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; font-family: var(--font-mono); font-size: 12px; margin-bottom: 15px; cursor: text; border-radius: 4px; }
        .login-input:focus { border-color: #fff; }
        .enter-btn { width: 100%; background: #fff; color: #000; border: none; padding: 15px; font-weight: 800; cursor: pointer; margin-top: 10px; transition: 0.2s; border-radius: 4px; }
        .enter-btn:hover { background: #ccc; }
        .verify-btn { float: right; background: #222; color: #ccc; border: 1px solid #444; padding: 5px 10px; font-size: 10px; cursor: pointer; margin-top: -10px; margin-bottom: 10px; border-radius: 4px; }
        
        /* --- ZODIAC SKIN SELECTOR (NEW STYLE) --- */
        .zodiac-title { font-size: 14px; color: #fff; text-align: center; margin: 25px 0 15px 0; font-weight: 700; letter-spacing: 1px; }
        .zodiac-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .z-btn { 
            background: #111; border: 2px solid #333; color: #666; padding: 15px 5px; 
            cursor: pointer; text-align: center; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; border-radius: 12px; transition: 0.3s;
        }
        .z-btn:hover { border-color: #666; background: #1a1a1a; color: #ccc; }
        .z-btn.selected { border-color: var(--accent-data); color: #fff; background: #1a1a1a; box-shadow: 0 0 20px rgba(59, 130, 246, 0.2); }
        
        .z-icon { font-size: 36px; margin-bottom: 5px; transition: 0.3s; filter: grayscale(0.8); }
        .z-btn:hover .z-icon, .z-btn.selected .z-icon { transform: scale(1.15); filter: grayscale(0); }
        .z-label { font-size: 9px; font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7; }
        .z-btn.selected .z-label { opacity: 1; color: var(--accent-data); }

        /* --- LAYOUT --- */
        header { height: 60px; border-bottom: 1px solid var(--border); background: #050505; display: flex; align-items: center; justify-content: space-between; padding: 0 24px; }
        .brand { font-size: 18px; font-weight: 900; color: #fff; letter-spacing: 2px; }
        .user-badge { font-family: var(--font-mono); font-size: 11px; padding: 4px 10px; border: 1px solid #333; border-radius: 4px; }
        
        #workspace { flex: 1; display: grid; grid-template-columns: 360px 1fr 320px; overflow: hidden; }

        .sidebar { background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar.right { border-right: none; border-left: 1px solid var(--border); }
        .p-head { padding: 20px; border-bottom: 1px solid var(--border); font-size: 12px; font-weight: 700; color: #fff; letter-spacing: 1px; }
        .p-body { flex: 1; overflow-y: auto; padding: 20px; }

        /* --- MODULES --- */
        #panel-mission { display: none; }
        .step-card { border: 1px solid #333; padding: 15px; margin-bottom: 15px; background: #0e0e0e; opacity: 0.4; pointer-events: none; transition: 0.3s; position: relative; border-radius: 6px; }
        .step-card.active { opacity: 1; pointer-events: all; border-color: #555; background: #111; }
        .step-card.done { border-color: var(--accent-xiaoer); opacity: 0.8; }
        .step-card.done::after { content: 'âœ“'; position: absolute; top: 10px; right: 10px; color: var(--accent-xiaoer); font-weight: bold; }
        
        .step-title { font-size: 11px; font-weight: 700; color: #fff; margin-bottom: 5px; }
        .step-desc { font-size: 10px; color: #666; margin-bottom: 10px; line-height: 1.4; }
        
        .action-btn { width: 100%; background: #222; border: 1px solid #444; color: #ccc; padding: 10px; font-size: 10px; cursor: pointer; margin-bottom: 5px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; border-radius: 4px; }
        .action-btn:hover { border-color: #fff; color: #fff; }
        .action-btn.primary { background: #fff; color: #000; border-color: #fff; }
        .action-btn.warn { background: rgba(245, 158, 11, 0.1); border-color: var(--accent-dushe); color: var(--accent-dushe); }
        
        .email-panel { background: #151515; border: 1px dashed #444; padding: 10px; margin-bottom: 10px; display: none; border-radius: 6px; }
        .email-status { font-size: 10px; color: var(--accent-data); margin-bottom: 8px; font-family: var(--font-mono); }
        .resend-link { font-size: 9px; color: #666; text-decoration: underline; cursor: pointer; float: right; margin-top: 5px; }
        .resend-link:hover { color: #fff; }

        /* --- MISSION MODULES --- */
        .module { margin-bottom: 25px; border-bottom: 1px dashed #222; padding-bottom: 20px; }
        .mod-title { font-size: 11px; color: #666; font-weight: 700; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        
        .aoi-box { border: 1px solid #222; padding: 10px; background: #0a0a0a; margin-bottom: 10px; border-radius: 6px; }
        .aoi-label { font-size: 9px; color: var(--accent-data); font-weight: 700; margin-bottom: 5px; border-bottom: 1px solid #222; padding-bottom: 2px; }
        .sys-select { width: 100%; background: #151515; border: 1px solid #333; color: #ccc; padding: 8px; font-family: var(--font-mono); font-size: 11px; margin-bottom: 5px; outline: none; border-radius: 4px; }
        .upload-zone { border: 1px dashed #444; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; background: rgba(255,255,255,0.01); border-radius: 6px; }
        .upload-zone:hover { border-color: var(--accent-data); color: var(--accent-data); }

        .year-toggle { display: flex; justify-content: space-between; align-items: center; background: #111; border: 1px solid #222; padding: 10px; margin-bottom: 5px; cursor: pointer; opacity: 1; transition: 0.3s; border-radius: 6px; }
        .year-toggle.disabled { opacity: 0.3; pointer-events: none; border-style: dashed; }
        .year-toggle.active { border-color: #fff; background: #1a1a1a; }
        .year-tag { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }

        /* --- MONITOR --- */
        .monitor-card { background: #111; border: 1px solid #333; padding: 15px; margin-bottom: 10px; border-radius: 6px; }
        .monitor-label { font-size: 9px; color: #666; margin-bottom: 5px; }
        .monitor-val { font-family: var(--font-mono); font-size: 14px; font-weight: 700; color: #fff; }
        .monitor-val.warn { color: var(--accent-dushe); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        .coverage-report { background: #111; padding: 15px; border: 1px solid #333; display: none; margin-top:20px; border-radius: 6px; }
        .cov-bar { height: 4px; background: #333; margin: 8px 0; position: relative; border-radius: 2px; }
        .cov-fill { height: 100%; background: var(--accent-data); width: 0%; transition: 1s; border-radius: 2px; }

        /* --- ADMIN --- */
        #adminPanel { display: none; }
        body.god-mode #panel-compliance { display: none; }
        body.god-mode #panel-mission { display: block; }
        body.god-mode #userPanel { display: none; }
        body.god-mode #adminPanel { display: block; }
        .admin-card { background: #0f0f0f; border: 1px solid #333; padding: 15px; margin-bottom: 10px; border-radius: 6px; }
        .status-select { background: #000; color: #ccc; border: 1px solid #444; padding: 4px; font-size: 10px; font-family: var(--font-mono); border-radius: 4px; }

        /* --- MAP & AI --- */
        #map { width: 100%; height: 100%; background: #0b0b0b; z-index: 1; }
        .leaflet-tile-pane { filter: grayscale(100%) contrast(1.5) brightness(0.6); }
        body.god-mode .leaflet-tile-pane { filter: sepia(100%) hue-rotate(5deg) saturate(1.5) brightness(0.6); }

        .ai-widget { 
            position: fixed; bottom: 20px; right: 340px; width: 340px; 
            background: rgba(0,0,0,0.95); border: 1px solid #333; z-index: 500; 
            display: flex; flex-direction: column; border-radius: 6px; 
            transition: border-color 0.3s;
        }
        .working { border-color: var(--accent-dushe) !important; box-shadow