<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPEN RS HUB // Command Center</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* --- 1. CORE VARIABLES (SCI-FI BLUE THEME) --- */
        :root {
            --bg: #050a14;                      /* Ê∑±Á©∫ËìùËÉåÊôØ */
            --panel: rgba(10, 20, 40, 0.95);    /* ÂçäÈÄèÊòéÊ∑±ËìùÈù¢Êùø */
            --border: #00e5ff;                  /* ËçßÂÖâÈùíËæπÊ°Ü */
            --accent: #00e5ff;                  /* ‰∏ªÂº∫Ë∞ÉËâ≤ÔºöËçßÂÖâÈùí */
            --accent-glow: rgba(0, 229, 255, 0.5); /* ËæâÂÖâÊïàÊûú */
            --text: #e0f7ff;                    /* ‰∫ÆÁôΩËìùÊñáÂ≠ó */
            --text-mute: #7a9cc6;               /* ÊüîÂíåËìùÊñáÂ≠ó */
            --font-mono: 'SF Mono', 'Consolas', monospace;
            --cursor-default: auto;
            --cursor-pointer: pointer;
        }

        /* Global Reset & Base Styles */
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            height: 100vh; overflow: hidden; 
            cursor: var(--cursor-default); 
            transition: background 0.5s;
        }

        /* Enforce Custom Cursor */
        button, a, .toggle, .ai-avatar-btn, .astro-btn, .cursor-option, .music-btn, .launch-btn-trigger, .role-btn, .entry-card, .portal-link, .close-btn {
            cursor: var(--cursor-pointer) !important;
        }
        
        /* Sci-Fi Glow Utility Class */
        .glow-border { border: 1px solid var(--border); box-shadow: 0 0 10px var(--accent-glow), inset 0 0 5px var(--accent-glow); }
        .glow-text { text-shadow: 0 0 5px var(--accent); }

        /* --- 2. ENTRY OVERLAY (ÂêàËßÑÁõæÁâå) --- */
        #entryOverlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(5, 10, 20, 0.99);
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease;
            padding: 20px; text-align: center;
            backdrop-filter: blur(20px);
        }
        
        .entry-title { 
            font-size: 32px; font-weight: 800; letter-spacing: 3px; color: var(--accent); 
            margin-bottom: 10px; text-shadow: 0 0 15px var(--accent-glow);
        }
        .entry-sub { 
            font-family: var(--font-mono); font-size: 14px; color: var(--text-mute); 
            margin-bottom: 40px; letter-spacing: 1px; text-transform: uppercase;
        }
        
        /* Legal Box */
        .legal-box {
            max-width: 600px;
            font-size: 11px; color: var(--text-mute); line-height: 1.6;
            margin-bottom: 40px; padding: 20px;
            background: rgba(0, 229, 255, 0.05);
            border: 1px solid var(--border);
            box-shadow: 0 0 15px var(--accent-glow);
            border-radius: 8px;
            font-family: var(--font-mono);
        }

        /* Zodiac Selection Grid */
        .cursor-selection-grid { 
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; 
            max-width: 800px;
        }
        .entry-card {
            width: 90px; height: 100px;
            background: rgba(16, 27, 45, 0.8);
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .entry-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--accent); 
            background: rgba(0, 229, 255, 0.1);
            box-shadow: 0 0 20px var(--accent-glow); 
        }
        .entry-icon { font-size: 36px; margin-bottom: 10px; filter: drop-shadow(0 0 5px var(--accent)); }
        .entry-label { font-size: 10px; font-weight: bold; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; }

        /* --- 3. MAP (VISUAL STYLING) --- */
        #map { 
            width: 100vw; height: 100vh; z-index: 1; 
            /* Ê†∏ÂøÉÊîπÂä®Ôºö‰ΩøÁî®Ê∑±ËìùÊª§Èïú */
            filter: grayscale(0.3) contrast(1.3) brightness(0.8) hue-rotate(180deg) saturate(1.5);
            background: #050a14; 
            transition: filter 1s; 
        }

        /* --- 4. COMMON PANEL STYLES --- */
        .panel-base {
            position: absolute; background: var(--panel); 
            border: 1px solid var(--border); border-radius: 8px;
            backdrop-filter: blur(10px); z-index: 10;
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.2), inset 0 0 5px rgba(0, 229, 255, 0.1);
        }
        .header-base {
            padding: 15px; background: rgba(0, 229, 255, 0.05);
            border-bottom: 1px solid var(--border);
            border-radius: 8px 8px 0 0;
        }
        .title-base { font-weight: 800; font-size: 14px; letter-spacing: 1px; color: var(--accent); text-transform: uppercase; text-shadow: 0 0 5px var(--accent); }
        .subtitle-base { font-size: 10px; color: var(--text-mute); margin-top: 5px; font-family: var(--font-mono); }
        .section-title { font-size: 11px; color: var(--accent); text-transform: uppercase; margin-bottom: 12px; letter-spacing: 1px; font-weight: 700; }

        /* --- 5. LEFT SIDEBAR --- */
        .sidebar { top: 20px; left: 20px; width: 280px; max-height: 85vh; overflow-y: auto; }
        .sidebar::-webkit-scrollbar { width: 0; }

        .layer-list { padding: 15px; }
        .layer-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .layer-name { font-size: 13px; font-weight: 600; color: var(--text); }
        .layer-src { font-size: 10px; color: var(--text-mute); display: block; margin-top: 2px;}
        
        /* Toggle Switch (Blue Style) */
        .toggle { appearance: none; width: 36px; height: 20px; background: #1a2638; border: 1px solid #30363d; border-radius: 10px; position: relative; transition: 0.3s; }
        .toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 14px; height: 14px; background: var(--text-mute); border-radius: 50%; transition: 0.3s; box-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .toggle:checked { background: rgba(0, 229, 255, 0.2); border-color: var(--accent); }
        .toggle:checked::after { transform: translateX(16px); background: var(--accent); box-shadow: 0 0 10px var(--accent); }

        .cursor-station { padding: 15px; border-top: 1px solid var(--border); }
        .cursor-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
        .cursor-option {
            width: 36px; height: 36px; background: rgba(16, 27, 45, 0.5); border-radius: 6px;
            display: flex; justify-content: center; align-items: center;
            border: 1px solid transparent; transition: 0.2s; font-size: 20px;
        }
        .cursor-option:hover { background: rgba(0, 229, 255, 0.1); border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow); }
        .cursor-option.active { border-color: var(--accent); background: rgba(0, 229, 255, 0.2); box-shadow: 0 0 15px var(--accent-glow); }

        .sidebar-footer { padding: 15px; border-top: 1px solid var(--border); font-size: 9px; color: var(--text-mute); line-height: 1.4; font-family: var(--font-mono); }

        /* --- 6. RIGHT SIDEBAR (MISSION CONTROL) --- */
        .portal-sidebar { top: 20px; right: 20px; width: 250px; }
        .portal-list { padding: 10px; max-height: 400px; overflow-y: auto; }
        .portal-group { margin-bottom: 15px; }
        .portal-link {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; background: rgba(16, 27, 45, 0.5); margin-bottom: 6px;
            border-radius: 4px; border: 1px solid rgba(0, 229, 255, 0.2); transition: 0.2s; text-decoration: none;
        }
        .portal-link:hover { border-color: var(--accent); background: rgba(0, 229, 255, 0.1); transform: translateX(-5px); box-shadow: 0 0 10px var(--accent-glow); }
        .p-name { font-size: 12px; color: var(--text); font-weight: 500; }
        .p-tag { font-size: 9px; color: var(--text-mute); font-family: var(--font-mono); display: block; margin-top: 2px;}
        .p-arrow { color: var(--accent); font-size: 14px; text-shadow: 0 0 5px var(--accent); }

        /* --- 7. NEWBIE PANEL (BOTTOM LEFT) --- */
        .launch-btn-trigger {
            position: absolute; bottom: 20px; left: 20px;
            width: 50px; height: 50px;
            background: var(--panel); border: 1px solid var(--border);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            z-index: 1000; font-size: 24px; box-shadow: 0 0 15px var(--accent-glow);
            transition: 0.3s;
        }
        .launch-btn-trigger:hover { transform: translateY(-3px) scale(1.1); background: var(--accent); color: #000; box-shadow: 0 0 25px var(--accent); }
        
        .launch-panel {
            position: absolute; bottom: 80px; left: 20px;
            width: 340px; display: none; flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .lp-body { padding: 0; max-height: 300px; overflow-y: auto; }
        .mission-card { padding: 15px; border-bottom: 1px solid var(--border); position: relative; transition: 0.2s; }
        .mission-card:hover { background: rgba(0, 229, 255, 0.05); }
        .m-name { font-weight: bold; color: var(--accent); font-size: 15px; margin-bottom: 4px; text-shadow: 0 0 5px var(--accent-glow); }
        .m-rocket { color: var(--text-mute); font-size: 12px; display: flex; align-items: center; gap: 5px; margin-top: 5px; }
        .m-timer { font-family: var(--font-mono); font-size: 13px; color: var(--text); margin-top: 8px; font-weight: bold; }
        .m-tag { position: absolute; top: 15px; right: 15px; font-size: 10px; background: rgba(0, 229, 255, 0.1); border: 1px solid var(--accent); padding: 2px 6px; border-radius: 4px; color: var(--accent); }

        /* --- 8. AI TERMINAL (BOTTOM RIGHT) --- */
        .chat-terminal {
            position: absolute; bottom: 90px; right: 20px;
            width: 380px; height: 500px; display: none; flex-direction: column;
            animation: popUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; transform-origin: bottom right; } to { transform: scale(1); opacity: 1; } }

        .chat-header { padding: 12px 15px; background: rgba(0, 229, 255, 0.05); border-bottom: 1px solid var(--border); border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; font-size: 13px; }
        .msg { padding: 10px 14px; border-radius: 8px; max-width: 85%; line-height: 1.5; animation: fadeIn 0.3s; border: 1px solid transparent; }
        .msg-ai { align-self: flex-start; background: rgba(16, 27, 45, 0.8); border-color: var(--border); border-left: 3px solid var(--accent); }
        .msg-user { align-self: flex-end; background: rgba(0, 229, 255, 0.1); border-color: var(--accent); color: var(--accent); font-weight: 600; text-align: right; box-shadow: 0 0 10px var(--accent-glow); }
        .tag-sys { font-size: 10px; opacity: 0.8; display: block; margin-bottom: 4px; font-family: var(--font-mono); color: var(--accent); }
        .roast-card { margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; border: 1px dashed var(--border); font-family: var(--font-mono); font-size: 11px; color: var(--text-mute); }

        .input-area { padding: 12px; background: rgba(0, 229, 255, 0.05); border-top: 1px solid var(--border); border-radius: 0 0 8px 8px; display: flex; gap: 8px; }
        .input-field { flex: 1; background: rgba(16, 27, 45, 0.5); border: 1px solid var(--border); padding: 10px; color: var(--accent); border-radius: 4px; outline: none; font-family: var(--font-mono); transition: 0.3s; }
        .input-field:focus { background: rgba(0, 229, 255, 0.1); box-shadow: 0 0 15px var(--accent-glow); }

        .ai-avatar-btn {
            position: absolute; bottom: 20px; right: 20px;
            width: 60px; height: 60px; background: var(--panel);
            border: 2px solid var(--accent); border-radius: 14px;
            box-shadow: 0 0 20px var(--accent-glow); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.2s;
        }
        .ai-avatar-btn:hover { transform: rotate(-5deg) scale(1.05); background: var(--accent); }
        .ai-avatar-btn:hover .bot-face { border-color: #000; background: #000; }
        .ai-avatar-btn:hover .bot-eye, .ai-avatar-btn:hover .bot-mouth { background: var(--accent); }
        
        .bot-face { width: 32px; height: 22px; background: #000; border-radius: 4px; position: relative; border: 2px solid var(--accent); box-shadow: 0 0 10px var(--accent-glow); }
        .bot-eye { position: absolute; top: 6px; width: 4px; height: 4px; background: var(--accent); animation: blink 4s infinite; box-shadow: 0 0 5px var(--accent); }
        .eye-l { left: 6px; } .eye-r { right: 6px; }
        .bot-mouth { position: absolute; bottom: 5px; left: 8px; right: 8px; height: 2px; background: var(--accent); box-shadow: 0 0 5px var(--accent); }
        @keyframes blink { 0%, 96%, 100% { height: 4px; } 98% { height: 1px; top: 8px; } }
        
        .astro-btn { width: 24px; height: 24px; fill: var(--text-mute); cursor: pointer; transition: 0.3s; }
        .astro-btn:hover { fill: var(--accent); transform: rotate(15deg); filter: drop-shadow(0 0 5px var(--accent)); }
        
        .music-panel { display: none; padding: 10px; background: rgba(0,0,0,0.5); border-bottom: 1px solid var(--border); gap: 10px; font-size: 11px; align-items: center; font-family: var(--font-mono); }
        .music-btn { background: rgba(0, 229, 255, 0.1); color: var(--accent); border: 1px solid var(--accent); padding: 4px 8px; border-radius: 4px; transition: 0.2s; }
        .music-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 10px var(--accent-glow); }

    </style>
</head>
<body>

    <div id="entryOverlay">
        <div class="entry-title">OPEN RS HUB</div>
        <div class="entry-sub">GLOBAL SATELLITE COMMAND INTERFACE</div>
        
        <div class="legal-box">
            <b>[ COMPLIANCE & ATTRIBUTION PROTOCOL ]</b><br>
            // This platform is an open-source visualization tool for public domain remote sensing data.<br>
            // All imagery references (Sentinel, Landsat) belong to their respective agencies (ESA, NASA, USGS).<br>
            // We operate in strict adherence to international open data policies.<br>
            <span style="color: var(--accent);">// STATUS: NO PERSONAL GEOLOCATION DATA STORED. (GDPR COMPLIANT)</span>
        </div>

        <div style="font-size:11px; margin-bottom:15px; color:var(--accent); font-family:var(--font-mono); letter-spacing:1px;">[ SELECT FLIGHT INTERFACE ID ]</div>
        
        <div class="cursor-selection-grid">
            <div class="entry-card" onclick="startGame('aries')"><div class="entry-icon">üêè</div><div class="entry-label">Aries</div></div>
            <div class="entry-card" onclick="startGame('taurus')"><div class="entry-icon">üêÇ</div><div class="entry-label">Taurus</div></div>
            <div class="entry-card" onclick="startGame('gemini')"><div class="entry-icon">üëØ</div><div class="entry-label">Gemini</div></div>
            <div class="entry-card" onclick="startGame('cancer')"><div class="entry-icon">ü¶Ä</div><div class="entry-label">Cancer</div></div>
            <div class="entry-card" onclick="startGame('leo')"><div class="entry-icon">ü¶Å</div><div class="entry-label">Leo</div></div>
            <div class="entry-card" onclick="startGame('virgo')"><div class="entry-icon">üßö</div><div class="entry-label">Virgo</div></div>
            <div class="entry-card" onclick="startGame('libra')"><div class="entry-icon">‚öñÔ∏è</div><div class="entry-label">Libra</div></div>
            <div class="entry-card" onclick="startGame('scorpio')"><div class="entry-icon">ü¶Ç</div><div class="entry-label">Scorpio</div></div>
            <div class="entry-card" onclick="startGame('sagittarius')"><div class="entry-icon">üèπ</div><div class="entry-label">Sagittarius</div></div>
            <div class="entry-card" onclick="startGame('capricorn')"><div class="entry-icon">üêê</div><div class="entry-label">Capricorn</div></div>
            <div class="entry-card" onclick="startGame('aquarius')"><div class="entry-icon">üè∫</div><div class="entry-label">Aquarius</div></div>
            <div class="entry-card" onclick="startGame('pisces')"><div class="entry-icon">üêü</div><div class="entry-label">Pisces</div></div>
        </div>
    </div>

    <div id="map"></div>

    <aside class="sidebar panel-base">
        <div class="header-base">
            <div class="title-base">OPEN RS HUB</div>
            <div class="subtitle-base">Global Monitor // V4.0.1</div>
        </div>
        
        <div class="layer-list">
            <div class="section-title">OPTICAL FEED</div>
            <div class="layer-row">
                <div class="layer-info"><div class="layer-name">Sentinel-2 (ESA)</div><span class="layer-src">10m MSI Optical</span></div>
                <input type="checkbox" class="toggle" checked>
            </div>
            <div class="layer-row">
                <div class="layer-info"><div class="layer-name">Landsat 8/9 (USGS)</div><span class="layer-src">30m OLI/TIRS</span></div>
                <input type="checkbox" class="toggle">
            </div>
            
            <div class="section-title" style="margin-top:15px;">ENVIRONMENTAL SENSORS</div>
            <div class="layer-row">
                <div class="layer-info"><div class="layer-name">VIIRS Night Lights</div><span class="layer-src">NASA / NOAA Suomi NPP</span></div>
                <input type="checkbox" class="toggle">
            </div>
            <div class="layer-row">
                <div class="layer-info"><div class="layer-name">Active Fires (FIRMS)</div><span class="layer-src">NASA EOSDIS LANCE</span></div>
                <input type="checkbox" class="toggle">
            </div>
             <div class="layer-row">
                <div class="layer-info"><div class="layer-name">Cloud Cover (GOES)</div><span class="layer-src">NOAA Real-time Geostationary</span></div>
                <input type="checkbox" class="toggle">
            </div>
        </div>
        
        <div class="cursor-station">
            <div class="section-title">ZODIAC INTERFACE</div>
            <div class="cursor-grid">
                <div class="cursor-option" id="opt-aries" onclick="setCursor('aries')" title="Aries">üêè</div>
                <div class="cursor-option" id="opt-taurus" onclick="setCursor('taurus')" title="Taurus">üêÇ</div>
                <div class="cursor-option" id="opt-gemini" onclick="setCursor('gemini')" title="Gemini">üëØ</div>
                <div class="cursor-option" id="opt-cancer" onclick="setCursor('cancer')" title="Cancer">ü¶Ä</div>
                <div class="cursor-option" id="opt-leo" onclick="setCursor('leo')" title="Leo">ü¶Å</div>
                <div class="cursor-option" id="opt-virgo" onclick="setCursor('virgo')" title="Virgo">üßö</div>
                <div class="cursor-option" id="opt-libra" onclick="setCursor('libra')" title="Libra">‚öñÔ∏è</div>
                <div class="cursor-option" id="opt-scorpio" onclick="setCursor('scorpio')" title="Scorpio">ü¶Ç</div>
                <div class="cursor-option" id="opt-sagittarius" onclick="setCursor('sagittarius')" title="Sagittarius">üèπ</div>
                <div class="cursor-option" id="opt-capricorn" onclick="setCursor('capricorn')" title="Capricorn">üêê</div>
                <div class="cursor-option" id="opt-aquarius" onclick="setCursor('aquarius')" title="Aquarius">üè∫</div>
                <div class="cursor-option" id="opt-pisces" onclick="setCursor('pisces')" title="Pisces">üêü</div>
            </div>
        </div>

        <div class="sidebar-footer">
            <b>[ SYSTEM ATTRIBUTION ]</b><br>
            Contains modified Copernicus Sentinel data [2024].<br>
            USGS/NASA Landsat Program data.<br>
            Visualization purposes only. Not for navigation.
        </div>
    </aside>

    <div class="portal-sidebar panel-base">
        <div class="header-base">
            <div class="title-base">MISSION CONTROL // DIRECTORY</div>
        </div>
        <div class="portal-list">
            <div class="section-title" style="margin-bottom:5px;">COMMERCIAL HIGH-RES</div>
            <div class="portal-group">
                <a href="https://discover.maxar.com/" target="_blank" class="portal-link">
                    <div><div class="p-name">MAXAR Discover</div><span class="p-tag">0.3m HD Optical</span></div><div class="p-arrow">‚Üó</div>
                </a>
                <a href="https://www.planet.com/explorer/" target="_blank" class="portal-link">
                    <div><div class="p-name">Planet Explorer</div><span class="p-tag">Daily Monitoring (3-5m)</span></div><div class="p-arrow">‚Üó</div>
                </a>
                <a href="https://www.intelligence-airbusds.com/geostore/" target="_blank" class="portal-link">
                    <div><div class="p-name">Airbus OneAtlas</div><span class="p-tag">Pleiades Neo (0.3m)</span></div><div class="p-arrow">‚Üó</div>
                </a>
                <a href="https://imagehunter.apollomapping.com/" target="_blank" class="portal-link">
                    <div><div class="p-name">Image Hunter</div><span class="p-tag">Multi-Source Aggregator</span></div><div class="p-arrow">‚Üó</div>
                </a>
            </div>

            <div class="section-title" style="margin-bottom:5px;">SAR & SPECIALTY</div>
            <div class="portal-group">
                <a href="https://www.capellaspace.com/gallery/" target="_blank" class="portal-link">
                    <div><div class="p-name">Capella Space</div><span class="p-tag">X-Band SAR (Sub-0.5m)</span></div><div class="p-arrow">‚Üó</div>
                </a>
                <a href="https://www.iceye.com/downloads/datasets" target="_blank" class="portal-link">
                    <div><div class="p-name">ICEYE Public Data</div><span class="p-tag">Microsat SAR Constellation</span></div><div class="p-arrow">‚Üó</div>
                </a>
                <a href="https://earth.nullschool.net/" target="_blank" class="portal-link">
                    <div><div class="p-name">Earth Nullschool</div><span class="p-tag">Global Wind/Weather Viz</span></div><div class="p-arrow">‚Üó</div>
                </a>
            </div>
        </div>
    </div>

    <div class="launch-btn-trigger" onclick="toggleLaunch()" title="Incoming Manifest">üê£</div>
    <div class="launch-panel panel-base" id="launchPanel">
        <div class="header-base" style="display: flex; justify-content: space-between; align-items: center;">
            <span class="title-base">ORBIT NEWBIES CHECK-IN</span>
            <span style="font-size:16px; cursor:pointer; color:var(--accent);" onclick="toggleLaunch()">√ó</span>
        </div>
        <div class="lp-body" id="launchList"></div>
        <div style="padding:10px; font-size:9px; color:var(--text-mute); text-align:center; border-top:1px solid var(--border); font-family:var(--font-mono);">
            [ DATA SYNCED WITH PUBLIC LAUNCH MANIFESTS ]
        </div>
    </div>

    <div class="ai-avatar-btn" onclick="toggleChat()"><div class="bot-face"><div class="bot-eye eye-l"></div><div class="bot-eye eye-r"></div><div class="bot-mouth"></div></div></div>
    
    <div class="chat-terminal panel-base" id="terminal">
        <div class="chat-header">
            <div style="display:flex; align-items:center; gap:10px;">
                <canvas id="visualizer" style="width:40px; height:20px; opacity:0.8;"></canvas>
                <span class="title-base" style="font-size:12px;">CO-PILOT v2.0</span>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <span style="cursor:pointer; color:var(--accent);" onclick="toggleNightMode()" title="Toggle Night/Chill Mode">üåô</span>
                <div title="Call Station Master" onclick="callHuman()">
                     <svg class="astro-btn" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12C20,14.4 18.9,16.55 17.16,18L16.56,17.2C16.16,16.63 15.54,16.27 14.85,16.19C15.56,15.53 16,14.62 16,13.63C16,12.04 14.54,10.79 12.85,11.03C11.5,11.23 10.5,12.39 10.5,13.75C10.5,14.71 10.96,15.56 11.66,16.12C11,16.23 10.42,16.61 10.05,17.15L9.36,18.09C7.03,16.35 5.5,13.62 5.5,10.5A6.5,6.5 0 0,1 12,4M12,6A4.5,4.5 0 0,0 7.5,10.5C7.5,12.18 8.41,13.66 9.77,14.45L10.55,13.38L10.57,13.35C10.68,13.2 11.28,12.38 12,12.38C12.72,12.38 13.32,13.2 13.43,13.35L13.45,13.38L14.23,14.45C15.59,13.66 16.5,12.18 16.5,10.5A4.5,4.5 0 0,0 12,6Z"/></svg>
                </div>
            </div>
        </div>
        <div class="music-panel" id="musicPanel">
            <input type="file" id="audioInput" style="display:none" accept="audio/*" onchange="playMusic(this)">
            <button onclick="document.getElementById('audioInput').click()" class="music-btn">üìÇ Load Local MP3</button>
            <span id="songTitle" style="color:var(--text-mute); flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">No Track Loaded</span>
            <audio id="player" loop></audio>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="input-area">
            <input type="text" class="input-field" id="userInput" placeholder="Enter command..." onkeypress="handleKey(event)">
        </div>
    </div>

    <script>
        // --- 1. MAP SETUP (WITH RESTRICTIONS & BLUE FILTER) ---
        const map = L.map('map', {
            zoomControl: false,
            minZoom: 3, 
            maxBounds: [[-90, -180], [90, 180]],
            maxBoundsViscosity: 1.0,
            attributionControl: false
        }).setView([20, 0], 3);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // --- 2. ENTRY & ZODIAC CURSOR LOGIC ---
        const cursorSVG = (emoji) => `url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36' style='font-size:28px; filter:drop-shadow(0 0 5px %2300e5ff);'><text x='50%' y='60%' dominant-baseline='middle' text-anchor='middle'>${emoji}</text></svg>") 18 18, auto`;

        const cursors = {
            'aries':    cursorSVG('üêè'), 'taurus':   cursorSVG('üêÇ'),
            'gemini':   cursorSVG('üëØ'), 'cancer':   cursorSVG('ü¶Ä'),
            'leo':      cursorSVG('ü¶Å'), 'virgo':    cursorSVG('üßö'),
            'libra':    cursorSVG('‚öñÔ∏è'), 'scorpio':  cursorSVG('ü¶Ç'),
            'sagittarius':cursorSVG('üèπ'),'capricorn':cursorSVG('üêê'),
            'aquarius': cursorSVG('üè∫'), 'pisces':   cursorSVG('üêü')
        };

        function startGame(choice) {
            setCursor(choice);
            const overlay = document.getElementById('entryOverlay');
            overlay.style.opacity = '0';
            setTimeout(() => { overlay.style.display = 'none'; }, 800);
            
            const chatBody = document.getElementById('chatBody');
            chatBody.innerHTML = `
                <div class="msg msg-ai">
                    <span class="tag-sys">[SYSTEM_READY]</span><br>
                    Welcome aboard, Commander.<br>
                    Zodiac Interface: <b>${choice.toUpperCase()}</b> loaded.<br>
                    <span style="font-size:10px; color:var(--text-mute); font-style:italic;">(Secure uplink established with open source catalogs.)</span>
                </div>
            `;
        }

        function setCursor(type) {
            document.documentElement.style.setProperty('--cursor-default', cursors[type]);
            document.documentElement.style.setProperty('--cursor-pointer', cursors[type]);
            document.querySelectorAll('.cursor-option').forEach(d => d.classList.remove('active'));
            const activeBtn = document.getElementById('opt-'+type);
            if(activeBtn) activeBtn.classList.add('active');
        }

        // --- 3. NEWBIE DATA (ORBIT CHECK-IN) ---
        const launches = [
            { name: "Albedo Space", rocket: "Falcon 9", tag: "üî• 0.1m Res", desc: "The new King of Clarity?", time: new Date(Date.now() + 1000 * 60 * 60 * 24 * 15) },
            { name: "MethaneSAT", rocket: "Transporter", tag: "üåø AI+Climate", desc: "Watching planet breathe.", time: new Date(Date.now() + 1000 * 60 * 60 * 48) },
            { name: "Jilin-1", rocket: "Ceres-1", tag: "üöÄ Daily Revisit", desc: "Faster than delivery.", time: new Date(Date.now() + 1000 * 60 * 60 * 5) }
        ];

        function renderLaunches() {
            const container = document.getElementById('launchList');
            container.innerHTML = "";
            launches.forEach(m => {
                const diff = m.time - Date.now();
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                const html = `
                    <div class="mission-card" style="border-left: 3px solid ${m.name.includes('Albedo') ? 'var(--portal-accent)' : 'var(--accent)'}">
                        <div class="m-tag" style="border-color:${m.name.includes('Albedo') ? 'var(--portal-accent)' : 'var(--accent)'}; color:${m.name.includes('Albedo') ? 'var(--portal-accent)' : 'var(--accent)'}">${m.tag}</div>
                        <div class="m-name" style="color:${m.name.includes('Albedo') ? 'var(--portal-accent)' : 'var(--accent)'}">${m.name}</div>
                        <div style="font-size:11px; color:var(--text-mute); margin-bottom:5px;">"${m.desc}"</div>
                        <div class="m-rocket">üì¶ Delivery: ${m.rocket}</div>
                        <div class="m-timer">üê£ ETA: ${days}d ${hours}h to orbit</div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }
        setInterval(renderLaunches, 60000); renderLaunches();
        function toggleLaunch() { 
            const p = document.getElementById('launchPanel');
            p.style.display = p.style.display === 'flex' ? 'none' : 'flex'; 
        }

        // --- 4. AI TERMINAL (DUAL PERSONA + MUSIC VIZ) ---
        const chatBody = document.getElementById('chatBody');
        const input = document.getElementById('userInput');
        let isNight = false;
        let audioCtx, analyser, dataArray, canvas, ctx;

        function handleKey(e) { if(e.key === 'Enter') sendMsg(); }

        function sendMsg() {
            const txt = input.value.trim();
            if(!txt) return;
            chatBody.innerHTML += `<div class="msg msg-user">${txt}</div>`;
            input.value = "";
            chatBody.scrollTop = chatBody.scrollHeight;
            
            const loaders = isNight ? 
                ["Listening to the void...", "Analyzing star patterns...", "Just you and me..."] : 
                ["Querying open catalogs...", "Checking license agreements...", "Filtering optimism..."];
            const rndLoad = loaders[Math.floor(Math.random()*loaders.length)];
            const thinkingId = "think-"+Date.now();
            
            chatBody.innerHTML += `<div id="${thinkingId}" style="margin-top:10px; font-size:11px; color:var(--text-mute); font-style:italic; font-family:var(--font-mono);">[PROCESSING] > ${rndLoad}</div>`;
            chatBody.scrollTop = chatBody.scrollHeight;
            setTimeout(() => { document.getElementById(thinkingId).remove(); reply(txt); }, 1000);
        }

        function reply(txt) {
            let msg = "";
            let roast = "";
            txt = txt.toLowerCase();

            // Legal/Compliance Trigger
            if(txt.includes("legal") || txt.includes("rules") || txt.includes("compliance")) {
                 msg = "System operates under Open Source Protocols.";
                 roast = "<b>‚öñÔ∏è COMPLIANCE LOG</b><br>Data sources: ESA, USGS, NASA.<br>Privacy: No user data stored.<br>Status: Green.";
            }
            else if(isNight) {
                if(txt.includes("free")) msg = "We'll do our best with Sentinel. It's beautiful too.";
                else if(txt.includes("contact")) msg = "It's late. Email ceo@constellport.com and rest.";
                else if(txt.includes("cloud")) msg = "Take a break. Clouds will pass.";
                else msg = "I'm listening. The music is nice.";
            } else {
                if(txt.includes("free") && (txt.includes("hd") || txt.includes("0.5"))) {
                    msg = "I detect optimism.";
                    roast = "<b>‚ö†Ô∏è REALITY CHECK</b><br>You want: 0.5m HD (Free)<br>Physics allows: 10m (Sentinel)<br>Suggestion: Lower standards.";
                }
                else if(txt.includes("contact") || txt.includes("email")) { callHuman(); return; }
                else if(txt.includes("cloud")) { msg = "Clouds block sensors."; roast = "<b>‚òÅÔ∏è PHYSICS ERROR</b><br>Try SAR or pray for wind."; }
                else if(txt.includes("singapore")) { map.setView([1.35, 103.8], 12); msg = "Teleporting to Singapore."; }
                else if(txt.includes("launch") || txt.includes("newbie")) { toggleLaunch(); msg = "Opening the Nursery."; }
                else { msg = "Command not recognized."; roast = "<b>ü§ñ ERROR</b><br>Try 'Launch', 'Cloud', 'Free'."; }
            }

            const html = `
                <div class="msg msg-ai">
                    <span class="tag-sys">${isNight ? '‚ô• [COMPANION]' : '[SYSTEM_LOG]'}</span>
                    ${msg}
                    ${roast ? `<div class="roast-card">${roast}</div>` : ''}
                </div>
            `;
            chatBody.innerHTML += html;
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function appendAiMsg(html) {
            chatBody.innerHTML += `<div class="msg msg-ai">${html}</div>`;
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function callHuman() {
            appendAiMsg(`<b>üë®‚ÄçüöÄ STATION MASTER</b><br>Email: <span style="color:${isNight?'#ff79c6':'var(--accent)'}">ceo@constellport.com</span>`);
        }

        function toggleNightMode() {
            isNight = !isNight;
            document.getElementById('musicPanel').style.display = isNight ? 'flex' : 'none';
            if(!isNight) {
                 document.getElementById('player').pause();
                 if(audioCtx) audioCtx.suspend();
            } else {
                 if(audioCtx) audioCtx.resume();
                 initAudio();
            }
            appendAiMsg(`<span style="color:${isNight?'#ff79c6':'var(--accent)'}">${isNight ? '‚ô• NIGHT MODE ACTIVE' : 'WORK MODE ACTIVE'}</span>`);
        }

        function playMusic(el) {
            const file = el.files[0];
            if(file) {
                document.getElementById('songTitle').innerText = file.name;
                const p = document.getElementById('player');
                p.src = URL.createObjectURL(file);
                p.play();
                initAudio();
            }
        }

        function initAudio() {
            if(!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                const source = audioCtx.createMediaElementSource(document.getElementById('player'));
                source.connect(analyser);
                analyser.connect(audioCtx.destination);
                analyser.fftSize = 64;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                canvas = document.getElementById('visualizer');
                ctx = canvas.getContext('2d');
                animateViz();
            }
        }

        function animateViz() {
            requestAnimationFrame(animateViz);
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const barWidth = (canvas.width / dataArray.length) * 1.5;
            let x = 0;
            for(let i = 0; i < dataArray.length; i++) {
                const barHeight = dataArray[i] / 2;
                ctx.fillStyle = isNight ? '#ff79c6' : '#00e5ff';
                ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                x += barWidth + 1;
            }
        }

        let isChatOpen = false;
        function toggleChat() {
            const t = document.getElementById('terminal');
            isChatOpen = !isChatOpen;
            t.style.display = isChatOpen ? 'flex' : 'none';
        }
    </script>
</body>
</html>